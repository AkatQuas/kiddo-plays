{
  "version": 3,
  "sources": ["../../../../../../front_end/core/sdk/CSSStyleSheetHeader.ts"],
  "sourcesContent": ["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as Common from '../common/common.js';\nimport * as i18n from '../i18n/i18n.js';\nimport * as Platform from '../platform/platform.js';\nimport * as Root from '../root/root.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nimport type {CSSModel} from './CSSModel.js';\nimport {DeferredDOMNode} from './DOMModel.js';\nimport type {FrameAssociated} from './FrameAssociated.js';\nimport type {PageResourceLoadInitiator} from './PageResourceLoader.js';\nimport {ResourceTreeModel} from './ResourceTreeModel.js';\n\nconst UIStrings = {\n  /**\n  *@description Error message for when a CSS file can't be loaded\n  */\n  couldNotFindTheOriginalStyle: 'Could not find the original style sheet.',\n  /**\n  *@description Error message to display when a source CSS file could not be retrieved.\n  */\n  thereWasAnErrorRetrievingThe: 'There was an error retrieving the source styles.',\n};\nconst str_ = i18n.i18n.registerUIStrings('core/sdk/CSSStyleSheetHeader.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class CSSStyleSheetHeader implements TextUtils.ContentProvider.ContentProvider, FrameAssociated {\n  #cssModelInternal: CSSModel;\n  id: Protocol.CSS.StyleSheetId;\n  frameId: Protocol.Page.FrameId;\n  sourceURL: Platform.DevToolsPath.UrlString;\n  hasSourceURL: boolean;\n  origin: Protocol.CSS.StyleSheetOrigin;\n  title: string;\n  disabled: boolean;\n  isInline: boolean;\n  isMutable: boolean;\n  isConstructed: boolean;\n  startLine: number;\n  startColumn: number;\n  endLine: number;\n  endColumn: number;\n  contentLength: number;\n  ownerNode: DeferredDOMNode|undefined;\n  sourceMapURL: Platform.DevToolsPath.UrlString|undefined;\n  #originalContentProviderInternal: TextUtils.StaticContentProvider.StaticContentProvider|null;\n\n  constructor(cssModel: CSSModel, payload: Protocol.CSS.CSSStyleSheetHeader) {\n    this.#cssModelInternal = cssModel;\n    this.id = payload.styleSheetId;\n    this.frameId = payload.frameId;\n    this.sourceURL = payload.sourceURL as Platform.DevToolsPath.UrlString;\n    this.hasSourceURL = Boolean(payload.hasSourceURL);\n    this.origin = payload.origin;\n    this.title = payload.title;\n    this.disabled = payload.disabled;\n    this.isInline = payload.isInline;\n    this.isMutable = payload.isMutable;\n    this.isConstructed = payload.isConstructed;\n    this.startLine = payload.startLine;\n    this.startColumn = payload.startColumn;\n    this.endLine = payload.endLine;\n    this.endColumn = payload.endColumn;\n    this.contentLength = payload.length;\n    if (payload.ownerNode) {\n      this.ownerNode = new DeferredDOMNode(cssModel.target(), payload.ownerNode);\n    }\n    this.sourceMapURL = payload.sourceMapURL as Platform.DevToolsPath.UrlString;\n    this.#originalContentProviderInternal = null;\n  }\n\n  originalContentProvider(): TextUtils.ContentProvider.ContentProvider {\n    if (!this.#originalContentProviderInternal) {\n      const lazyContent = (async(): Promise<TextUtils.ContentProvider.DeferredContent> => {\n        const originalText = await this.#cssModelInternal.originalStyleSheetText(this);\n        if (originalText === null) {\n          return {content: null, error: i18nString(UIStrings.couldNotFindTheOriginalStyle), isEncoded: false};\n        }\n        return {content: originalText, isEncoded: false};\n      });\n      this.#originalContentProviderInternal =\n          new TextUtils.StaticContentProvider.StaticContentProvider(this.contentURL(), this.contentType(), lazyContent);\n    }\n    return this.#originalContentProviderInternal;\n  }\n\n  setSourceMapURL(sourceMapURL?: Platform.DevToolsPath.UrlString): void {\n    this.sourceMapURL = sourceMapURL;\n  }\n\n  cssModel(): CSSModel {\n    return this.#cssModelInternal;\n  }\n\n  isAnonymousInlineStyleSheet(): boolean {\n    return !this.resourceURL() && !this.#cssModelInternal.sourceMapManager().sourceMapForClient(this);\n  }\n\n  isConstructedByNew(): boolean {\n    return this.isConstructed && this.sourceURL.length === 0;\n  }\n\n  resourceURL(): Platform.DevToolsPath.UrlString {\n    const url = this.isViaInspector() ? this.viaInspectorResourceURL() : this.sourceURL;\n    if (!url && Root.Runtime.experiments.isEnabled(Root.Runtime.ExperimentName.STYLES_PANE_CSS_CHANGES)) {\n      return this.dynamicStyleURL();\n    }\n    return url;\n  }\n\n  private getFrameURLPath(): string {\n    const model = this.#cssModelInternal.target().model(ResourceTreeModel);\n    console.assert(Boolean(model));\n    if (!model) {\n      return '';\n    }\n    const frame = model.frameForId(this.frameId);\n    if (!frame) {\n      return '';\n    }\n    console.assert(Boolean(frame));\n    const parsedURL = new Common.ParsedURL.ParsedURL(frame.url);\n    let urlPath = parsedURL.host + parsedURL.folderPathComponents;\n    if (!urlPath.endsWith('/')) {\n      urlPath += '/';\n    }\n    return urlPath;\n  }\n\n  private viaInspectorResourceURL(): Platform.DevToolsPath.UrlString {\n    return `inspector://${this.getFrameURLPath()}inspector-stylesheet` as Platform.DevToolsPath.UrlString;\n  }\n\n  private dynamicStyleURL(): Platform.DevToolsPath.UrlString {\n    return `stylesheet://${this.getFrameURLPath()}style#${this.id}` as Platform.DevToolsPath.UrlString;\n  }\n\n  lineNumberInSource(lineNumberInStyleSheet: number): number {\n    return this.startLine + lineNumberInStyleSheet;\n  }\n\n  columnNumberInSource(lineNumberInStyleSheet: number, columnNumberInStyleSheet: number): number|undefined {\n    return (lineNumberInStyleSheet ? 0 : this.startColumn) + columnNumberInStyleSheet;\n  }\n\n  /**\n   * Checks whether the position is in this style sheet. Assumes that the\n   * position's columnNumber is consistent with line endings.\n   */\n  containsLocation(lineNumber: number, columnNumber: number): boolean {\n    const afterStart =\n        (lineNumber === this.startLine && columnNumber >= this.startColumn) || lineNumber > this.startLine;\n    const beforeEnd = lineNumber < this.endLine || (lineNumber === this.endLine && columnNumber <= this.endColumn);\n    return afterStart && beforeEnd;\n  }\n\n  contentURL(): Platform.DevToolsPath.UrlString {\n    return this.resourceURL();\n  }\n\n  contentType(): Common.ResourceType.ResourceType {\n    return Common.ResourceType.resourceTypes.Stylesheet;\n  }\n\n  contentEncoded(): Promise<boolean> {\n    return Promise.resolve(false);\n  }\n\n  async requestContent(): Promise<TextUtils.ContentProvider.DeferredContent> {\n    try {\n      const cssText = await this.#cssModelInternal.getStyleSheetText(this.id);\n      return {content: (cssText as string), isEncoded: false};\n    } catch (err) {\n      return {\n        content: null,\n        error: i18nString(UIStrings.thereWasAnErrorRetrievingThe),\n        isEncoded: false,\n      };\n    }\n  }\n\n  async searchInContent(query: string, caseSensitive: boolean, isRegex: boolean):\n      Promise<TextUtils.ContentProvider.SearchMatch[]> {\n    const requestedContent = await this.requestContent();\n    if (requestedContent.content === null) {\n      return [];\n    }\n    return TextUtils.TextUtils.performSearchInContent(requestedContent.content, query, caseSensitive, isRegex);\n  }\n\n  isViaInspector(): boolean {\n    return this.origin === 'inspector';\n  }\n\n  createPageResourceLoadInitiator(): PageResourceLoadInitiator {\n    return {\n      target: null,\n      frameId: this.frameId,\n      initiatorUrl: this.hasSourceURL ? Platform.DevToolsPath.EmptyUrlString : this.sourceURL,\n    };\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
