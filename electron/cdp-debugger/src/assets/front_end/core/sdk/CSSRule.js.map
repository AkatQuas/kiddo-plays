{
  "version": 3,
  "sources": ["../../../../../../front_end/core/sdk/CSSRule.ts"],
  "sourcesContent": ["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Protocol from '../../generated/protocol.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as Platform from '../platform/platform.js';\n\nimport {CSSContainerQuery} from './CSSContainerQuery.js';\nimport {CSSLayer} from './CSSLayer.js';\nimport {CSSMedia} from './CSSMedia.js';\nimport {CSSSupports} from './CSSSupports.js';\n\nimport type {CSSModel, Edit} from './CSSModel.js';\nimport {CSSStyleDeclaration, Type} from './CSSStyleDeclaration.js';\nimport type {CSSStyleSheetHeader} from './CSSStyleSheetHeader.js';\n\nexport class CSSRule {\n  readonly cssModelInternal: CSSModel;\n  styleSheetId: Protocol.CSS.StyleSheetId|undefined;\n  sourceURL: string|undefined;\n  origin: Protocol.CSS.StyleSheetOrigin;\n  style: CSSStyleDeclaration;\n\n  constructor(cssModel: CSSModel, payload: {\n    style: Protocol.CSS.CSSStyle,\n    styleSheetId: Protocol.CSS.StyleSheetId|undefined,\n    origin: Protocol.CSS.StyleSheetOrigin,\n  }) {\n    this.cssModelInternal = cssModel;\n    this.styleSheetId = payload.styleSheetId;\n\n    if (this.styleSheetId) {\n      const styleSheetHeader = this.getStyleSheetHeader(this.styleSheetId);\n      this.sourceURL = styleSheetHeader.sourceURL;\n    }\n    this.origin = payload.origin;\n    this.style = new CSSStyleDeclaration(this.cssModelInternal, this, payload.style, Type.Regular);\n  }\n\n  rebase(edit: Edit): void {\n    if (this.styleSheetId !== edit.styleSheetId) {\n      return;\n    }\n    this.style.rebase(edit);\n  }\n\n  resourceURL(): Platform.DevToolsPath.UrlString {\n    if (!this.styleSheetId) {\n      return Platform.DevToolsPath.EmptyUrlString;\n    }\n    const styleSheetHeader = this.getStyleSheetHeader(this.styleSheetId);\n    return styleSheetHeader.resourceURL();\n  }\n\n  isUserAgent(): boolean {\n    return this.origin === Protocol.CSS.StyleSheetOrigin.UserAgent;\n  }\n\n  isInjected(): boolean {\n    return this.origin === Protocol.CSS.StyleSheetOrigin.Injected;\n  }\n\n  isViaInspector(): boolean {\n    return this.origin === Protocol.CSS.StyleSheetOrigin.Inspector;\n  }\n\n  isRegular(): boolean {\n    return this.origin === Protocol.CSS.StyleSheetOrigin.Regular;\n  }\n\n  cssModel(): CSSModel {\n    return this.cssModelInternal;\n  }\n\n  getStyleSheetHeader(styleSheetId: Protocol.CSS.StyleSheetId): CSSStyleSheetHeader {\n    const styleSheetHeader = this.cssModelInternal.styleSheetHeaderForId(styleSheetId);\n    console.assert(styleSheetHeader !== null);\n    return styleSheetHeader as CSSStyleSheetHeader;\n  }\n}\n\nclass CSSValue {\n  text: string;\n  range: TextUtils.TextRange.TextRange|undefined;\n  constructor(payload: Protocol.CSS.Value) {\n    this.text = payload.text;\n    if (payload.range) {\n      this.range = TextUtils.TextRange.TextRange.fromObject(payload.range);\n    }\n  }\n\n  rebase(edit: Edit): void {\n    if (!this.range) {\n      return;\n    }\n    this.range = this.range.rebaseAfterTextEdit(edit.oldRange, edit.newRange);\n  }\n}\n\nexport class CSSStyleRule extends CSSRule {\n  selectors!: CSSValue[];\n  media: CSSMedia[];\n  containerQueries: CSSContainerQuery[];\n  supports: CSSSupports[];\n  layers: CSSLayer[];\n  wasUsed: boolean;\n  constructor(cssModel: CSSModel, payload: Protocol.CSS.CSSRule, wasUsed?: boolean) {\n    // TODO(crbug.com/1011811): Replace with spread operator or better types once Closure is gone.\n    super(cssModel, {origin: payload.origin, style: payload.style, styleSheetId: payload.styleSheetId});\n    this.reinitializeSelectors(payload.selectorList);\n    this.media = payload.media ? CSSMedia.parseMediaArrayPayload(cssModel, payload.media) : [];\n    this.containerQueries = payload.containerQueries ?\n        CSSContainerQuery.parseContainerQueriesPayload(cssModel, payload.containerQueries) :\n        [];\n    this.supports = payload.supports ? CSSSupports.parseSupportsPayload(cssModel, payload.supports) : [];\n    this.layers = payload.layers ? CSSLayer.parseLayerPayload(cssModel, payload.layers) : [];\n    this.wasUsed = wasUsed || false;\n  }\n\n  static createDummyRule(cssModel: CSSModel, selectorText: string): CSSStyleRule {\n    const dummyPayload = {\n      selectorList: {\n        text: '',\n        selectors: [{text: selectorText, value: undefined}],\n      },\n      style: {\n        styleSheetId: '0' as Protocol.CSS.StyleSheetId,\n        range: new TextUtils.TextRange.TextRange(0, 0, 0, 0),\n        shorthandEntries: [],\n        cssProperties: [],\n      },\n      origin: Protocol.CSS.StyleSheetOrigin.Inspector,\n    };\n    return new CSSStyleRule(cssModel, (dummyPayload as Protocol.CSS.CSSRule));\n  }\n\n  private reinitializeSelectors(selectorList: Protocol.CSS.SelectorList): void {\n    this.selectors = [];\n    for (let i = 0; i < selectorList.selectors.length; ++i) {\n      this.selectors.push(new CSSValue(selectorList.selectors[i]));\n    }\n  }\n\n  setSelectorText(newSelector: string): Promise<boolean> {\n    const styleSheetId = this.styleSheetId;\n    if (!styleSheetId) {\n      throw 'No rule stylesheet id';\n    }\n    const range = this.selectorRange();\n    if (!range) {\n      throw 'Rule selector is not editable';\n    }\n    return this.cssModelInternal.setSelectorText(styleSheetId, range, newSelector);\n  }\n\n  selectorText(): string {\n    return this.selectors.map(selector => selector.text).join(', ');\n  }\n\n  selectorRange(): TextUtils.TextRange.TextRange|null {\n    const firstRange = this.selectors[0].range;\n    const lastRange = this.selectors[this.selectors.length - 1].range;\n    if (!firstRange || !lastRange) {\n      return null;\n    }\n    return new TextUtils.TextRange.TextRange(\n        firstRange.startLine, firstRange.startColumn, lastRange.endLine, lastRange.endColumn);\n  }\n\n  lineNumberInSource(selectorIndex: number): number {\n    const selector = this.selectors[selectorIndex];\n    if (!selector || !selector.range || !this.styleSheetId) {\n      return 0;\n    }\n    const styleSheetHeader = this.getStyleSheetHeader(this.styleSheetId);\n    return styleSheetHeader.lineNumberInSource(selector.range.startLine);\n  }\n\n  columnNumberInSource(selectorIndex: number): number|undefined {\n    const selector = this.selectors[selectorIndex];\n    if (!selector || !selector.range || !this.styleSheetId) {\n      return undefined;\n    }\n    const styleSheetHeader = this.getStyleSheetHeader(this.styleSheetId);\n    return styleSheetHeader.columnNumberInSource(selector.range.startLine, selector.range.startColumn);\n  }\n\n  rebase(edit: Edit): void {\n    if (this.styleSheetId !== edit.styleSheetId) {\n      return;\n    }\n    const range = this.selectorRange();\n    if (range && range.equal(edit.oldRange)) {\n      this.reinitializeSelectors((edit.payload as Protocol.CSS.SelectorList));\n    } else {\n      for (let i = 0; i < this.selectors.length; ++i) {\n        this.selectors[i].rebase(edit);\n      }\n    }\n    this.media.forEach(media => media.rebase(edit));\n    this.containerQueries.forEach(cq => cq.rebase(edit));\n    this.supports.forEach(supports => supports.rebase(edit));\n\n    super.rebase(edit);\n  }\n}\n\nexport class CSSKeyframesRule {\n  readonly #animationName: CSSValue;\n  readonly #keyframesInternal: CSSKeyframeRule[];\n  constructor(cssModel: CSSModel, payload: Protocol.CSS.CSSKeyframesRule) {\n    this.#animationName = new CSSValue(payload.animationName);\n    this.#keyframesInternal = payload.keyframes.map(keyframeRule => new CSSKeyframeRule(cssModel, keyframeRule));\n  }\n\n  name(): CSSValue {\n    return this.#animationName;\n  }\n\n  keyframes(): CSSKeyframeRule[] {\n    return this.#keyframesInternal;\n  }\n}\n\nexport class CSSKeyframeRule extends CSSRule {\n  #keyText!: CSSValue;\n  constructor(cssModel: CSSModel, payload: Protocol.CSS.CSSKeyframeRule) {\n    // TODO(crbug.com/1011811): Replace with spread operator or better types once Closure is gone.\n    super(cssModel, {origin: payload.origin, style: payload.style, styleSheetId: payload.styleSheetId});\n    this.reinitializeKey(payload.keyText);\n  }\n\n  key(): CSSValue {\n    return this.#keyText;\n  }\n\n  private reinitializeKey(payload: Protocol.CSS.Value): void {\n    this.#keyText = new CSSValue(payload);\n  }\n\n  rebase(edit: Edit): void {\n    if (this.styleSheetId !== edit.styleSheetId || !this.#keyText.range) {\n      return;\n    }\n    if (edit.oldRange.equal(this.#keyText.range)) {\n      this.reinitializeKey((edit.payload as Protocol.CSS.Value));\n    } else {\n      this.#keyText.rebase(edit);\n    }\n\n    super.rebase(edit);\n  }\n\n  setKeyText(newKeyText: string): Promise<boolean> {\n    const styleSheetId = this.styleSheetId;\n    if (!styleSheetId) {\n      throw 'No rule stylesheet id';\n    }\n    const range = this.#keyText.range;\n    if (!range) {\n      throw 'Keyframe key is not editable';\n    }\n    return this.cssModelInternal.setKeyframeKey(styleSheetId, range, newKeyText);\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
