{
  "version": 3,
  "sources": ["../../../../../../../front_end/ui/components/markdown_view/MarkdownView.ts"],
  "sourcesContent": ["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as LitHtml from '../../lit-html/lit-html.js';\nimport type * as Marked from '../../../third_party/marked/marked.js';\nimport * as ComponentHelpers from '../../components/helpers/helpers.js';\nimport markdownViewStyles from './markdownView.css.js';\n\nimport type {MarkdownImageData} from './MarkdownImage.js';\nimport type {MarkdownLinkData} from './MarkdownLink.js';\nimport {MarkdownLink} from './MarkdownLink.js';\nimport {MarkdownImage} from './MarkdownImage.js';\n\nconst html = LitHtml.html;\nconst render = LitHtml.render;\n\nexport interface MarkdownViewData {\n  tokens: Marked.Marked.Token[];\n}\n\nexport class MarkdownView extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-markdown-view`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  // TODO(crbug.com/1108699): Replace with `Marked.Marked.Token[]` once AST types are fixed upstream.\n  #tokenData: readonly Object[] = [];\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [markdownViewStyles];\n  }\n\n  set data(data: MarkdownViewData) {\n    this.#tokenData = data.tokens;\n    this.#update();\n  }\n\n  #update(): void {\n    this.#render();\n  }\n\n  #render(): void {\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    render(html`\n      <div class='message'>\n        ${this.#tokenData.map(renderToken)}\n      </div>\n    `, this.#shadow, {host: this});\n    // clang-format on\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-markdown-view', MarkdownView);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-markdown-view': MarkdownView;\n  }\n}\n\n// TODO(crbug.com/1108699): Fix types when they are available.\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst renderChildTokens = (token: any): string => {\n  return token.tokens.map(renderToken);\n};\n\nconst unescape = (text: string): string => {\n  // Unescape will get rid of the escaping done by Marked to avoid double escaping due to escaping it also with Lit-html\n  // Table taken from: front_end/third_party/marked/package/src/helpers.js\n  const escapeReplacements = new Map<string, string>([\n    ['&amp;', '&'],\n    ['&lt;', '<'],\n    ['&gt;', '>'],\n    ['&quot;', '\"'],\n    ['&#39;', '\\''],\n  ]);\n  return text.replace(/&(amp|lt|gt|quot|#39);/g, (matchedString: string) => {\n    const replacement = escapeReplacements.get(matchedString);\n    return replacement ? replacement : matchedString;\n  });\n};\n// TODO(crbug.com/1108699): Fix types when they are available.\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst renderText = (token: any): LitHtml.TemplateResult => {\n  if (token.tokens && token.tokens.length > 0) {\n    return html`${renderChildTokens(token)}`;\n  }\n  // Due to unescaping, unescaped html entities (see escapeReplacements' keys) will be rendered\n  // as their corresponding symbol while the rest will be rendered as verbatim.\n  // Marked's escape function can be found in front_end/third_party/marked/package/src/helpers.js\n  return html`${unescape(token.text)}`;\n};\n\n// TODO(crbug.com/1108699): Fix types when they are available.\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst tokenRenderers = new Map<string, (token: any) => LitHtml.TemplateResult>([\n  ['paragraph', (token): LitHtml.TemplateResult => html`<p>${renderChildTokens(token)}`],\n  ['list', (token): LitHtml.TemplateResult => html`<ul>${token.items.map(renderToken)}</ul>`],\n  ['list_item', (token): LitHtml.TemplateResult => html`<li>${renderChildTokens(token)}`],\n  ['text', renderText],\n  ['codespan', (token): LitHtml.TemplateResult => html`<code>${unescape(token.text)}</code>`],\n  ['space', (): LitHtml.TemplateResult => html``],\n  [\n    'link',\n    (token): LitHtml.TemplateResult => html`<${MarkdownLink.litTagName} .data=${\n        {key: token.href, title: token.text} as MarkdownLinkData}></${MarkdownLink.litTagName}>`,\n  ],\n  [\n    'image',\n    (token): LitHtml.TemplateResult => html`<${MarkdownImage.litTagName} .data=${\n        {key: token.href, title: token.text} as MarkdownImageData}></${MarkdownImage.litTagName}>`,\n  ],\n]);\n\n// TODO(crbug.com/1108699): Fix types when they are available.\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const renderToken = (token: any): LitHtml.TemplateResult => {\n  const renderFn = tokenRenderers.get(token.type);\n  if (!renderFn) {\n    throw new Error(`Markdown token type '${token.type}' not supported.`);\n  }\n  return renderFn(token);\n};\n"],
  "mappings": "AAIA;AAEA;AACA;AAIA;AACA;AAEA,MAAM,OAAO,QAAQ;AACrB,MAAM,SAAS,QAAQ;AAMhB,kCAA2B,YAAY;AAAA,SAC5B,aAAa,QAAQ;AAAA,YAClB,KAAK,aAAa,EAAC,MAAM;AAAA,eAGZ;AAAA,EAEhC,oBAA0B;AACxB,iBAAa,qBAAqB,CAAC;AAAA;AAAA,MAGjC,KAAK,MAAwB;AAC/B,sBAAkB,KAAK;AACvB;AAAA;AAAA,YAGc;AACd;AAAA;AAAA,YAGc;AAGd,WAAO;AAAA;AAAA,UAED,gBAAgB,IAAI;AAAA;AAAA,OAEvB,cAAc,EAAC,MAAM;AAAA;AAAA;AAK5B,iBAAiB,eAAe,gBAAgB,0BAA0B;AAW1E,MAAM,oBAAoB,CAAC,UAAuB;AAChD,SAAO,MAAM,OAAO,IAAI;AAAA;AAG1B,MAAM,WAAW,CAAC,SAAyB;AAGzC,QAAM,qBAAqB,oBAAI,IAAoB;AAAA,IACjD,CAAC,SAAS;AAAA,IACV,CAAC,QAAQ;AAAA,IACT,CAAC,QAAQ;AAAA,IACT,CAAC,UAAU;AAAA,IACX,CAAC,SAAS;AAAA;AAEZ,SAAO,KAAK,QAAQ,2BAA2B,CAAC,kBAA0B;AACxE,UAAM,cAAc,mBAAmB,IAAI;AAC3C,WAAO,cAAc,cAAc;AAAA;AAAA;AAKvC,MAAM,aAAa,CAAC,UAAuC;AACzD,MAAI,MAAM,UAAU,MAAM,OAAO,SAAS,GAAG;AAC3C,WAAO,OAAO,kBAAkB;AAAA;AAKlC,SAAO,OAAO,SAAS,MAAM;AAAA;AAK/B,MAAM,iBAAiB,oBAAI,IAAoD;AAAA,EAC7E,CAAC,aAAa,CAAC,UAAkC,UAAU,kBAAkB;AAAA,EAC7E,CAAC,QAAQ,CAAC,UAAkC,WAAW,MAAM,MAAM,IAAI;AAAA,EACvE,CAAC,aAAa,CAAC,UAAkC,WAAW,kBAAkB;AAAA,EAC9E,CAAC,QAAQ;AAAA,EACT,CAAC,YAAY,CAAC,UAAkC,aAAa,SAAS,MAAM;AAAA,EAC5E,CAAC,SAAS,MAA8B;AAAA,EACxC;AAAA,IACE;AAAA,IACA,CAAC,UAAkC,QAAQ,aAAa,oBACpD,EAAC,KAAK,MAAM,MAAM,OAAO,MAAM,YAA+B,aAAa;AAAA;AAAA,EAEjF;AAAA,IACE;AAAA,IACA,CAAC,UAAkC,QAAQ,cAAc,oBACrD,EAAC,KAAK,MAAM,MAAM,OAAO,MAAM,YAAgC,cAAc;AAAA;AAAA;AAM9E,aAAM,cAAc,CAAC,UAAuC;AACjE,QAAM,WAAW,eAAe,IAAI,MAAM;AAC1C,MAAI,CAAC,UAAU;AACb,UAAM,IAAI,MAAM,wBAAwB,MAAM;AAAA;AAEhD,SAAO,SAAS;AAAA;",
  "names": []
}
