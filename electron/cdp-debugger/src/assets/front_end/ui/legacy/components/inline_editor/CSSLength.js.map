{
  "version": 3,
  "sources": ["../../../../../../../../front_end/ui/legacy/components/inline_editor/CSSLength.ts"],
  "sourcesContent": ["// Copyright (c) 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as ComponentHelpers from '../../../components/helpers/helpers.js';\nimport * as LitHtml from '../../../lit-html/lit-html.js';\nimport cssLengthStyles from './cssLength.css.js';\n\nimport type {Length} from './CSSLengthUtils.js';\nimport {LengthUnit, LENGTH_UNITS, parseText} from './CSSLengthUtils.js';\nimport {ValueChangedEvent} from './InlineEditorUtils.js';\n\nconst {render, html} = LitHtml;\n\nexport class DraggingFinishedEvent extends Event {\n  static readonly eventName = 'draggingfinished';\n  constructor() {\n    super(DraggingFinishedEvent.eventName, {});\n  }\n}\n\nexport interface CSSLengthData {\n  lengthText: string;\n}\n\nconst DefaultLength = {\n  value: 0,\n  unit: LengthUnit.PIXEL,\n};\n\nexport class CSSLength extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-css-length`;\n\n  private readonly shadow = this.attachShadow({mode: 'open'});\n  private readonly onDraggingValue = this.dragValue.bind(this);\n  private length: Length = DefaultLength;\n  private isEditingSlot = false;\n  private isDraggingValue = false;\n  private currentMouseClientX = 0;\n  #valueMousedownTime = 0;\n\n  set data(data: CSSLengthData) {\n    const parsedResult = parseText(data.lengthText);\n    if (!parsedResult) {\n      return;\n    }\n    this.length = parsedResult;\n    this.render();\n  }\n\n  connectedCallback(): void {\n    this.shadow.adoptedStyleSheets = [cssLengthStyles];\n  }\n\n  private onUnitChange(event: Event): void {\n    this.length.unit = (event.target as HTMLInputElement).value as LengthUnit;\n    this.dispatchEvent(new ValueChangedEvent(`${this.length.value}${this.length.unit}`));\n    this.dispatchEvent(new DraggingFinishedEvent());\n    this.render();\n  }\n\n  private dragValue(event: MouseEvent): void {\n    event.preventDefault();\n    event.stopPropagation();\n    if (Date.now() - this.#valueMousedownTime <= 300) {\n      // Delay drag callback by 300ms to prioritize click over drag.\n      return;\n    }\n\n    this.isDraggingValue = true;\n    let displacement = event.clientX - this.currentMouseClientX;\n    this.currentMouseClientX = event.clientX;\n    if (event.shiftKey) {\n      displacement *= 10;\n    }\n    if (event.altKey) {\n      displacement *= 0.1;\n    }\n    this.length.value = this.length.value + displacement;\n    this.dispatchEvent(new ValueChangedEvent(`${this.length.value}${this.length.unit}`));\n    this.render();\n  }\n\n  private onValueMousedown(event: MouseEvent): void {\n    if (event.button !== 0) {\n      return;\n    }\n\n    this.#valueMousedownTime = Date.now();\n\n    this.currentMouseClientX = event.clientX;\n    const targetDocument = event.target instanceof Node && event.target.ownerDocument;\n    if (targetDocument) {\n      targetDocument.addEventListener('mousemove', this.onDraggingValue, {capture: true});\n      targetDocument.addEventListener('mouseup', (event: MouseEvent) => {\n        targetDocument.removeEventListener('mousemove', this.onDraggingValue, {capture: true});\n\n        if (!this.isDraggingValue) {\n          return;\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n        this.isDraggingValue = false;\n        this.dispatchEvent(new DraggingFinishedEvent());\n      }, {once: true, capture: true});\n    }\n  }\n\n  private onValueMouseup(): void {\n    if (!this.isDraggingValue) {\n      this.isEditingSlot = true;\n      this.render();\n    }\n  }\n\n  private onUnitMouseup(event: MouseEvent): void {\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  private render(): void {\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    render(html`\n      <div class=\"css-length\">\n        ${this.renderContent()}\n      </div>\n    `, this.shadow, {\n      host: this,\n    });\n    // clang-format on\n  }\n\n  private renderContent(): LitHtml.TemplateResult {\n    if (this.isEditingSlot) {\n      return html`<slot></slot>`;\n    }\n    const options = LENGTH_UNITS.map(unit => {\n      return html`\n          <option value=${unit} .selected=${this.length.unit === unit}>${unit}</option>\n        `;\n    });\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n      return html`\n        <span class=\"value\"\n          @mousedown=${this.onValueMousedown}\n          @mouseup=${this.onValueMouseup}\n        >${this.length.value}</span><span class=\"unit\">${this.length.unit}</span><div class=\"unit-dropdown\">\n          <span class=\"icon\"></span>\n          <select @mouseup=${this.onUnitMouseup} @change=${this.onUnitChange}>\n            ${options}\n          </select>\n        </div>\n      `;\n    // clang-format on\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-css-length', CSSLength);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-css-length': CSSLength;\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
