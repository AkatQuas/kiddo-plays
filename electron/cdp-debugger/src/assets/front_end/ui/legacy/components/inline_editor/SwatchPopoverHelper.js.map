{
  "version": 3,
  "sources": ["../../../../../../../../front_end/ui/legacy/components/inline_editor/SwatchPopoverHelper.ts"],
  "sourcesContent": ["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as UI from '../../legacy.js';\n\nimport {ColorSwatch} from './ColorSwatch.js';\nimport swatchPopoverStyles from './swatchPopover.css.js';\n\nexport class SwatchPopoverHelper extends Common.ObjectWrapper.ObjectWrapper<EventTypes> {\n  private readonly popover: UI.GlassPane.GlassPane;\n  private readonly hideProxy: () => void;\n  private readonly boundOnKeyDown: (event: KeyboardEvent) => void;\n  private readonly boundFocusOut: (event: FocusEvent) => void;\n  private isHidden: boolean;\n  private anchorElement: Element|null;\n  private view?: UI.Widget.Widget;\n  private hiddenCallback?: ((arg0: boolean) => void);\n  private focusRestorer?: UI.Widget.WidgetFocusRestorer;\n\n  constructor() {\n    super();\n    this.popover = new UI.GlassPane.GlassPane();\n    this.popover.setSizeBehavior(UI.GlassPane.SizeBehavior.MeasureContent);\n    this.popover.setMarginBehavior(UI.GlassPane.MarginBehavior.Arrow);\n    this.popover.element.addEventListener('mousedown', e => e.consume(), false);\n\n    this.hideProxy = this.hide.bind(this, true);\n    this.boundOnKeyDown = this.onKeyDown.bind(this);\n    this.boundFocusOut = this.onFocusOut.bind(this);\n    this.isHidden = true;\n    this.anchorElement = null;\n  }\n\n  private onFocusOut(event: FocusEvent): void {\n    const relatedTarget = (event.relatedTarget as Element | null);\n    if (this.isHidden || !relatedTarget || !this.view || relatedTarget.isSelfOrDescendant(this.view.contentElement)) {\n      return;\n    }\n    this.hideProxy();\n  }\n\n  setAnchorElement(anchorElement: Element): void {\n    this.anchorElement = anchorElement;\n  }\n\n  isShowing(view?: UI.Widget.Widget): boolean {\n    return this.popover.isShowing() && ((view && this.view === view) || !view);\n  }\n\n  show(view: UI.Widget.Widget, anchorElement: Element, hiddenCallback?: ((arg0: boolean) => void)): void {\n    if (this.popover.isShowing()) {\n      if (this.anchorElement === anchorElement) {\n        return;\n      }\n\n      // Reopen the picker for another anchor element.\n      this.hide(true);\n    }\n\n    this.popover.registerCSSFiles([swatchPopoverStyles]);\n    this.dispatchEventToListeners(Events.WillShowPopover);\n\n    this.isHidden = false;\n    this.anchorElement = anchorElement;\n    this.view = view;\n    this.hiddenCallback = hiddenCallback;\n    this.reposition();\n    view.focus();\n\n    const document = this.popover.element.ownerDocument;\n    document.addEventListener('mousedown', this.hideProxy, false);\n    if (document.defaultView) {\n      document.defaultView.addEventListener('resize', this.hideProxy, false);\n    }\n    this.view.contentElement.addEventListener('keydown', this.boundOnKeyDown, false);\n  }\n\n  reposition(): void {\n    // This protects against trying to reposition the popover after it has been hidden.\n    if (this.isHidden || !this.view) {\n      return;\n    }\n    // Unbind \"blur\" listener to avoid reenterability: |popover.show()| will hide the popover and trigger it synchronously.\n    this.view.contentElement.removeEventListener('focusout', this.boundFocusOut, false);\n    this.view.show(this.popover.contentElement);\n    if (this.anchorElement) {\n      let anchorBox = this.anchorElement.boxInWindow();\n      if (ColorSwatch.isColorSwatch(this.anchorElement)) {\n        const swatch = (this.anchorElement as ColorSwatch);\n        if (!swatch.anchorBox) {\n          return;\n        }\n        anchorBox = swatch.anchorBox;\n      }\n\n      this.popover.setContentAnchorBox(anchorBox);\n      this.popover.show((this.anchorElement.ownerDocument as Document));\n    }\n    this.view.contentElement.addEventListener('focusout', this.boundFocusOut, false);\n    if (!this.focusRestorer) {\n      this.focusRestorer = new UI.Widget.WidgetFocusRestorer(this.view);\n    }\n  }\n\n  hide(commitEdit?: boolean): void {\n    if (this.isHidden) {\n      return;\n    }\n    const document = this.popover.element.ownerDocument;\n    this.isHidden = true;\n    this.popover.hide();\n\n    document.removeEventListener('mousedown', this.hideProxy, false);\n    if (document.defaultView) {\n      document.defaultView.removeEventListener('resize', this.hideProxy, false);\n    }\n\n    if (this.hiddenCallback) {\n      this.hiddenCallback.call(null, Boolean(commitEdit));\n    }\n\n    if (this.focusRestorer) {\n      this.focusRestorer.restore();\n    }\n    this.anchorElement = null;\n    if (this.view) {\n      this.view.detach();\n      this.view.contentElement.removeEventListener('keydown', this.boundOnKeyDown, false);\n      this.view.contentElement.removeEventListener('focusout', this.boundFocusOut, false);\n      delete this.view;\n    }\n  }\n\n  private onKeyDown(event: KeyboardEvent): void {\n    if (event.key === 'Enter') {\n      this.hide(true);\n      event.consume(true);\n      return;\n    }\n    if (event.key === Platform.KeyboardUtilities.ESCAPE_KEY) {\n      this.hide(false);\n      event.consume(true);\n    }\n  }\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Events {\n  WillShowPopover = 'WillShowPopover',\n}\n\nexport type EventTypes = {\n  [Events.WillShowPopover]: void,\n};\n"],
  "mappings": "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",
  "names": []
}
