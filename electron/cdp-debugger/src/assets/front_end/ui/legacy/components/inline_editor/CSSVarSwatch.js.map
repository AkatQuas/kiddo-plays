{
  "version": 3,
  "sources": ["../../../../../../../../front_end/ui/legacy/components/inline_editor/CSSVarSwatch.ts"],
  "sourcesContent": ["// Copyright (c) 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as ComponentHelpers from '../../../components/helpers/helpers.js';\nimport * as LitHtml from '../../../lit-html/lit-html.js';\nimport cssVarSwatchStyles from './cssVarSwatch.css.js';\n\nconst UIStrings = {\n  /**\n  *@description Text displayed in a tooltip shown when hovering over a var() CSS function in the Styles pane when the custom property in this function does not exist. The parameter is the name of the property.\n  *@example {--my-custom-property-name} PH1\n  */\n  sIsNotDefined: '{PH1} is not defined',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/inline_editor/CSSVarSwatch.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst {render, html, Directives} = LitHtml;\n\nconst VARIABLE_FUNCTION_REGEX = /(var\\()(\\s*--[^,)]+)(.*)/;\n\ninterface SwatchRenderData {\n  text: string;\n  computedValue: string|null;\n  fromFallback: boolean;\n  onLinkActivate: (varialeName: string) => void;\n}\n\ninterface ParsedVariableFunction {\n  pre: string;\n  name: string;\n  post: string;\n}\n\nexport class CSSVarSwatch extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-css-var-swatch`;\n  private readonly shadow = this.attachShadow({mode: 'open'});\n  private text: string = '';\n  private computedValue: string|null = null;\n  private fromFallback: boolean = false;\n  private onLinkActivate: (varialeName: string, event: MouseEvent|KeyboardEvent) => void = () => undefined;\n\n  constructor() {\n    super();\n\n    this.tabIndex = -1;\n\n    this.addEventListener('focus', () => {\n      const link = this.shadow.querySelector<HTMLElement>('[role=\"link\"]');\n\n      if (link) {\n        link.focus();\n      }\n    });\n  }\n\n  connectedCallback(): void {\n    this.shadow.adoptedStyleSheets = [cssVarSwatchStyles];\n  }\n\n  set data(data: SwatchRenderData) {\n    this.text = data.text;\n    this.computedValue = data.computedValue;\n    this.fromFallback = data.fromFallback;\n    this.onLinkActivate = (variableName: string, event: MouseEvent|KeyboardEvent): void => {\n      if (event instanceof MouseEvent && event.button !== 0) {\n        return;\n      }\n\n      if (event instanceof KeyboardEvent && !isEnterOrSpaceKey(event)) {\n        return;\n      }\n\n      data.onLinkActivate(variableName);\n      event.consume(true);\n    };\n    this.render();\n  }\n\n  private parseVariableFunctionParts(): ParsedVariableFunction|null {\n    // When the value of CSS var() is greater than two spaces, only one is\n    // always displayed, and the actual number of spaces is displayed when\n    // editing is clicked.\n    const result = this.text.replace(/\\s{2,}/g, ' ').match(VARIABLE_FUNCTION_REGEX);\n    if (!result) {\n      return null;\n    }\n\n    return {\n      pre: result[1],\n      name: result[2],\n      post: result[3],\n    };\n  }\n\n  private get variableName(): string {\n    const match = this.text.match(/--[^,)]+/);\n    if (match) {\n      return match[0];\n    }\n    return '';\n  }\n\n  private renderLink(variableName: string): LitHtml.TemplateResult {\n    const isDefined = this.computedValue && !this.fromFallback;\n\n    const classes = Directives.classMap({\n      'css-var-link': true,\n      'undefined': !isDefined,\n    });\n    const title = isDefined ? this.computedValue : i18nString(UIStrings.sIsNotDefined, {PH1: variableName});\n    // The this.variableName's space must be removed, otherwise it cannot be triggered when clicked.\n    const onActivate = isDefined ? this.onLinkActivate.bind(this, this.variableName.trim()) : null;\n\n    return html`<span class=${classes} title=${title} @mousedown=${onActivate} @keydown=${\n        onActivate} role=\"link\" tabindex=\"-1\">${variableName}</span>`;\n  }\n\n  private render(): void {\n    const functionParts = this.parseVariableFunctionParts();\n    if (!functionParts) {\n      render('', this.shadow, {host: this});\n      return;\n    }\n\n    const link = this.renderLink(functionParts.name);\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    render(\n      html`<span title=${this.computedValue || ''}>${functionParts.pre}${link}${functionParts.post}</span>`,\n      this.shadow, { host: this });\n    // clang-format on\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-css-var-swatch', CSSVarSwatch);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-css-var-swatch': CSSVarSwatch;\n  }\n}\n"],
  "mappings": "AAIA;AACA;AACA;AACA;AAEA,MAAM,YAAY;AAAA,EAKhB,eAAe;AAAA;AAEjB,MAAM,OAAO,KAAK,KAAK,kBAAkB,sDAAsD;AAC/F,MAAM,aAAa,KAAK,KAAK,mBAAmB,KAAK,QAAW;AAChE,MAAM,EAAC,QAAQ,MAAM,eAAc;AAEnC,MAAM,0BAA0B;AAezB,kCAA2B,YAAY;AAAA,SAC5B,aAAa,QAAQ;AAAA,EACpB,SAAS,KAAK,aAAa,EAAC,MAAM;AAAA,EAC3C,OAAe;AAAA,EACf,gBAA6B;AAAA,EAC7B,eAAwB;AAAA,EACxB,iBAAiF,MAAM;AAAA,EAE/F,cAAc;AACZ;AAEA,SAAK,WAAW;AAEhB,SAAK,iBAAiB,SAAS,MAAM;AACnC,YAAM,OAAO,KAAK,OAAO,cAA2B;AAEpD,UAAI,MAAM;AACR,aAAK;AAAA;AAAA;AAAA;AAAA,EAKX,oBAA0B;AACxB,SAAK,OAAO,qBAAqB,CAAC;AAAA;AAAA,MAGhC,KAAK,MAAwB;AAC/B,SAAK,OAAO,KAAK;AACjB,SAAK,gBAAgB,KAAK;AAC1B,SAAK,eAAe,KAAK;AACzB,SAAK,iBAAiB,CAAC,cAAsB,UAA0C;AACrF,UAAI,iBAAiB,cAAc,MAAM,WAAW,GAAG;AACrD;AAAA;AAGF,UAAI,iBAAiB,iBAAiB,CAAC,kBAAkB,QAAQ;AAC/D;AAAA;AAGF,WAAK,eAAe;AACpB,YAAM,QAAQ;AAAA;AAEhB,SAAK;AAAA;AAAA,EAGC,6BAA0D;AAIhE,UAAM,SAAS,KAAK,KAAK,QAAQ,WAAW,KAAK,MAAM;AACvD,QAAI,CAAC,QAAQ;AACX,aAAO;AAAA;AAGT,WAAO;AAAA,MACL,KAAK,OAAO;AAAA,MACZ,MAAM,OAAO;AAAA,MACb,MAAM,OAAO;AAAA;AAAA;AAAA,MAIL,eAAuB;AACjC,UAAM,QAAQ,KAAK,KAAK,MAAM;AAC9B,QAAI,OAAO;AACT,aAAO,MAAM;AAAA;AAEf,WAAO;AAAA;AAAA,EAGD,WAAW,cAA8C;AAC/D,UAAM,YAAY,KAAK,iBAAiB,CAAC,KAAK;AAE9C,UAAM,UAAU,WAAW,SAAS;AAAA,MAClC,gBAAgB;AAAA,MAChB,aAAa,CAAC;AAAA;AAEhB,UAAM,QAAQ,YAAY,KAAK,gBAAgB,WAAW,UAAU,eAAe,EAAC,KAAK;AAEzF,UAAM,aAAa,YAAY,KAAK,eAAe,KAAK,MAAM,KAAK,aAAa,UAAU;AAE1F,WAAO,mBAAmB,iBAAiB,oBAAoB,uBAC3D,wCAAwC;AAAA;AAAA,EAGtC,SAAe;AACrB,UAAM,gBAAgB,KAAK;AAC3B,QAAI,CAAC,eAAe;AAClB,aAAO,IAAI,KAAK,QAAQ,EAAC,MAAM;AAC/B;AAAA;AAGF,UAAM,OAAO,KAAK,WAAW,cAAc;AAI3C,WACE,mBAAmB,KAAK,iBAAiB,MAAM,cAAc,MAAM,OAAO,cAAc,eACxF,KAAK,QAAQ,EAAE,MAAM;AAAA;AAAA;AAK3B,iBAAiB,eAAe,gBAAgB,2BAA2B;",
  "names": []
}
