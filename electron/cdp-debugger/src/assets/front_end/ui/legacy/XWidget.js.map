{
  "version": 3,
  "sources": ["../../../../../../front_end/ui/legacy/XWidget.ts"],
  "sourcesContent": ["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as ComponentHelpers from '../components/helpers/helpers.js';\n\nimport {XElement} from './XElement.js';\n\nlet observer: ResizeObserver|null = null;\n\nconst storedScrollPositions = new WeakMap<Element, {\n  scrollLeft: number,\n  scrollTop: number,\n}>();\n\nexport class XWidget extends XElement {\n  private visible: boolean;\n  private readonly shadowRootInternal!: DocumentFragment|null;\n  private defaultFocusedElement: Element|null;\n  private elementsToRestoreScrollPositionsFor: Element[];\n  private onShownCallback!: (() => void)|null;\n  private onHiddenCallback!: (() => void)|null;\n  private onResizedCallback!: (() => void)|null;\n\n  constructor() {\n    super();\n    this.style.setProperty('display', 'flex');\n    this.style.setProperty('flex-direction', 'column');\n    this.style.setProperty('align-items', 'stretch');\n    this.style.setProperty('justify-content', 'flex-start');\n    this.style.setProperty('contain', 'layout style');\n\n    this.visible = false;\n    this.defaultFocusedElement = null;\n    this.elementsToRestoreScrollPositionsFor = [];\n\n    if (!observer) {\n      observer = new ResizeObserver(entries => {\n        for (const entry of entries) {\n          const widget = (entry.target as XWidget);\n          if (widget.visible && widget.onResizedCallback) {\n            widget.onResizedCallback.call(null);\n          }\n        }\n      });\n    }\n\n    observer.observe(this);\n\n    this.setElementsToRestoreScrollPositionsFor([this]);\n  }\n\n  isShowing(): boolean {\n    return this.visible;\n  }\n\n  setOnShown(callback: (() => void)|null): void {\n    this.onShownCallback = callback;\n  }\n\n  setOnHidden(callback: (() => void)|null): void {\n    this.onHiddenCallback = callback;\n  }\n\n  setOnResized(callback: (() => void)|null): void {\n    this.onResizedCallback = callback;\n  }\n\n  setElementsToRestoreScrollPositionsFor(elements: Element[]): void {\n    for (const element of this.elementsToRestoreScrollPositionsFor) {\n      element.removeEventListener('scroll', XWidget.storeScrollPosition, {capture: false});\n    }\n    this.elementsToRestoreScrollPositionsFor = elements;\n    for (const element of this.elementsToRestoreScrollPositionsFor) {\n      element.addEventListener('scroll', XWidget.storeScrollPosition, {passive: true, capture: false});\n    }\n  }\n\n  restoreScrollPositions(): void {\n    for (const element of this.elementsToRestoreScrollPositionsFor) {\n      const storedPositions = storedScrollPositions.get(element);\n      if (storedPositions) {\n        element.scrollTop = storedPositions.scrollTop;\n        element.scrollLeft = storedPositions.scrollLeft;\n      }\n    }\n  }\n\n  private static storeScrollPosition(event: Event): void {\n    const element = (event.currentTarget as Element);\n    storedScrollPositions.set(element, {scrollLeft: element.scrollLeft, scrollTop: element.scrollTop});\n  }\n\n  setDefaultFocusedElement(element: Element|null): void {\n    if (element && !this.isSelfOrAncestor(element)) {\n      throw new Error('Default focus must be descendant');\n    }\n    this.defaultFocusedElement = element;\n  }\n\n  focus(): void {\n    if (!this.visible) {\n      return;\n    }\n\n    let element;\n    if (this.defaultFocusedElement && this.isSelfOrAncestor(this.defaultFocusedElement)) {\n      element = this.defaultFocusedElement;\n    } else if (this.tabIndex !== -1) {\n      element = this;\n    } else {\n      let child = this.traverseNextNode(this);\n      while (child) {\n        if ((child instanceof XWidget) && child.visible) {\n          element = child;\n          break;\n        }\n        child = child.traverseNextNode(this);\n      }\n    }\n\n    if (!element || element.hasFocus()) {\n      return;\n    }\n    if (element === this) {\n      HTMLElement.prototype.focus.call(this);\n    } else {\n      (element as HTMLElement).focus();\n    }\n  }\n\n  connectedCallback(): void {\n    this.visible = true;\n    this.restoreScrollPositions();\n    if (this.onShownCallback) {\n      this.onShownCallback.call(null);\n    }\n  }\n\n  disconnectedCallback(): void {\n    this.visible = false;\n    if (this.onHiddenCallback) {\n      this.onHiddenCallback.call(null);\n    }\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('x-widget', XWidget);\n"],
  "mappings": "AAIA;AAEA;AAEA,IAAI,WAAgC;AAEpC,MAAM,wBAAwB,oBAAI;AAK3B,6BAAsB,SAAS;AAAA,EAC5B;AAAA,EACS;AAAA,EACT;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAER,cAAc;AACZ;AACA,SAAK,MAAM,YAAY,WAAW;AAClC,SAAK,MAAM,YAAY,kBAAkB;AACzC,SAAK,MAAM,YAAY,eAAe;AACtC,SAAK,MAAM,YAAY,mBAAmB;AAC1C,SAAK,MAAM,YAAY,WAAW;AAElC,SAAK,UAAU;AACf,SAAK,wBAAwB;AAC7B,SAAK,sCAAsC;AAE3C,QAAI,CAAC,UAAU;AACb,iBAAW,IAAI,eAAe,aAAW;AACvC,mBAAW,SAAS,SAAS;AAC3B,gBAAM,SAAU,MAAM;AACtB,cAAI,OAAO,WAAW,OAAO,mBAAmB;AAC9C,mBAAO,kBAAkB,KAAK;AAAA;AAAA;AAAA;AAAA;AAMtC,aAAS,QAAQ;AAEjB,SAAK,uCAAuC,CAAC;AAAA;AAAA,EAG/C,YAAqB;AACnB,WAAO,KAAK;AAAA;AAAA,EAGd,WAAW,UAAmC;AAC5C,SAAK,kBAAkB;AAAA;AAAA,EAGzB,YAAY,UAAmC;AAC7C,SAAK,mBAAmB;AAAA;AAAA,EAG1B,aAAa,UAAmC;AAC9C,SAAK,oBAAoB;AAAA;AAAA,EAG3B,uCAAuC,UAA2B;AAChE,eAAW,WAAW,KAAK,qCAAqC;AAC9D,cAAQ,oBAAoB,UAAU,QAAQ,qBAAqB,EAAC,SAAS;AAAA;AAE/E,SAAK,sCAAsC;AAC3C,eAAW,WAAW,KAAK,qCAAqC;AAC9D,cAAQ,iBAAiB,UAAU,QAAQ,qBAAqB,EAAC,SAAS,MAAM,SAAS;AAAA;AAAA;AAAA,EAI7F,yBAA+B;AAC7B,eAAW,WAAW,KAAK,qCAAqC;AAC9D,YAAM,kBAAkB,sBAAsB,IAAI;AAClD,UAAI,iBAAiB;AACnB,gBAAQ,YAAY,gBAAgB;AACpC,gBAAQ,aAAa,gBAAgB;AAAA;AAAA;AAAA;AAAA,SAK5B,oBAAoB,OAAoB;AACrD,UAAM,UAAW,MAAM;AACvB,0BAAsB,IAAI,SAAS,EAAC,YAAY,QAAQ,YAAY,WAAW,QAAQ;AAAA;AAAA,EAGzF,yBAAyB,SAA6B;AACpD,QAAI,WAAW,CAAC,KAAK,iBAAiB,UAAU;AAC9C,YAAM,IAAI,MAAM;AAAA;AAElB,SAAK,wBAAwB;AAAA;AAAA,EAG/B,QAAc;AACZ,QAAI,CAAC,KAAK,SAAS;AACjB;AAAA;AAGF,QAAI;AACJ,QAAI,KAAK,yBAAyB,KAAK,iBAAiB,KAAK,wBAAwB;AACnF,gBAAU,KAAK;AAAA,eACN,KAAK,aAAa,IAAI;AAC/B,gBAAU;AAAA,WACL;AACL,UAAI,QAAQ,KAAK,iBAAiB;AAClC,aAAO,OAAO;AACZ,YAAK,iBAAiB,WAAY,MAAM,SAAS;AAC/C,oBAAU;AACV;AAAA;AAEF,gBAAQ,MAAM,iBAAiB;AAAA;AAAA;AAInC,QAAI,CAAC,WAAW,QAAQ,YAAY;AAClC;AAAA;AAEF,QAAI,YAAY,MAAM;AACpB,kBAAY,UAAU,MAAM,KAAK;AAAA,WAC5B;AACL,MAAC,QAAwB;AAAA;AAAA;AAAA,EAI7B,oBAA0B;AACxB,SAAK,UAAU;AACf,SAAK;AACL,QAAI,KAAK,iBAAiB;AACxB,WAAK,gBAAgB,KAAK;AAAA;AAAA;AAAA,EAI9B,uBAA6B;AAC3B,SAAK,UAAU;AACf,QAAI,KAAK,kBAAkB;AACzB,WAAK,iBAAiB,KAAK;AAAA;AAAA;AAAA;AAKjC,iBAAiB,eAAe,gBAAgB,YAAY;",
  "names": []
}
