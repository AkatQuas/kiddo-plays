{
  "version": 3,
  "sources": ["../../../../../../front_end/panels/elements/DOMLinkifier.ts"],
  "sourcesContent": ["// Copyright 2018 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport domLinkifierStyles from './domLinkifier.css.js';\n\nconst UIStrings = {\n  /**\n  * @description Text displayed when trying to create a link to a node in the UI, but the node\n  * location could not be found so we display this placeholder instead. Node refers to a DOM node.\n  * This should be translated if appropriate.\n  */\n  node: '<node>',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/elements/DOMLinkifier.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport const decorateNodeLabel = function(\n    node: SDK.DOMModel.DOMNode, parentElement: HTMLElement, tooltipContent?: string): void {\n  const originalNode = node;\n  const isPseudo = node.nodeType() === Node.ELEMENT_NODE && node.pseudoType();\n  if (isPseudo && node.parentNode) {\n    node = node.parentNode;\n  }\n\n  let title = node.nodeNameInCorrectCase();\n\n  const nameElement = parentElement.createChild('span', 'node-label-name');\n  nameElement.textContent = title;\n\n  const idAttribute = node.getAttribute('id');\n  if (idAttribute) {\n    const idElement = parentElement.createChild('span', 'node-label-id');\n    const part = '#' + idAttribute;\n    title += part;\n    UI.UIUtils.createTextChild(idElement, part);\n\n    // Mark the name as extra, since the ID is more important.\n    nameElement.classList.add('extra');\n  }\n\n  const classAttribute = node.getAttribute('class');\n  if (classAttribute) {\n    const classes = classAttribute.split(/\\s+/);\n    if (classes.length) {\n      const foundClasses = new Set<string>();\n      const classesElement = parentElement.createChild('span', 'extra node-label-class');\n      for (let i = 0; i < classes.length; ++i) {\n        const className = classes[i];\n        if (className && !foundClasses.has(className)) {\n          const part = '.' + className;\n          title += part;\n          UI.UIUtils.createTextChild(classesElement, part);\n          foundClasses.add(className);\n        }\n      }\n    }\n  }\n\n  if (isPseudo) {\n    const pseudoElement = parentElement.createChild('span', 'extra node-label-pseudo');\n    const pseudoText = '::' + originalNode.pseudoType();\n    UI.UIUtils.createTextChild(pseudoElement, pseudoText);\n    title += pseudoText;\n  }\n  UI.Tooltip.Tooltip.install(parentElement, tooltipContent || title);\n};\n\nexport const linkifyNodeReference = function(\n    node: SDK.DOMModel.DOMNode|null, options: Common.Linkifier.Options|undefined = {\n      tooltip: undefined,\n      preventKeyboardFocus: undefined,\n    }): Node {\n  if (!node) {\n    return document.createTextNode(i18nString(UIStrings.node));\n  }\n\n  const root = document.createElement('span');\n  root.classList.add('monospace');\n  const shadowRoot =\n      UI.Utils.createShadowRootWithCoreStyles(root, {cssFile: [domLinkifierStyles], delegatesFocus: undefined});\n  const link = (shadowRoot.createChild('div', 'node-link') as HTMLDivElement);\n\n  decorateNodeLabel(node, link, options.tooltip);\n\n  link.addEventListener('click', () => {\n    void Common.Revealer.reveal(node, false);\n    return false;\n  }, false);\n  link.addEventListener('mouseover', node.highlight.bind(node, undefined), false);\n  link.addEventListener('mouseleave', () => SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight(), false);\n\n  if (!options.preventKeyboardFocus) {\n    link.addEventListener('keydown', event => event.key === 'Enter' && Common.Revealer.reveal(node, false) && false);\n    link.tabIndex = 0;\n    UI.ARIAUtils.markAsLink(link);\n  }\n\n  return root;\n};\n\nexport const linkifyDeferredNodeReference = function(\n    deferredNode: SDK.DOMModel.DeferredDOMNode, options: Common.Linkifier.Options|undefined = {\n      tooltip: undefined,\n      preventKeyboardFocus: undefined,\n    }): Node {\n  const root = document.createElement('div');\n  const shadowRoot =\n      UI.Utils.createShadowRootWithCoreStyles(root, {cssFile: [domLinkifierStyles], delegatesFocus: undefined});\n  const link = (shadowRoot.createChild('div', 'node-link') as HTMLDivElement);\n  link.createChild('slot');\n  link.addEventListener('click', deferredNode.resolve.bind(deferredNode, onDeferredNodeResolved), false);\n  link.addEventListener('mousedown', e => e.consume(), false);\n\n  if (!options.preventKeyboardFocus) {\n    link.addEventListener('keydown', event => event.key === 'Enter' && deferredNode.resolve(onDeferredNodeResolved));\n    link.tabIndex = 0;\n    UI.ARIAUtils.markAsLink(link);\n  }\n\n  function onDeferredNodeResolved(node: SDK.DOMModel.DOMNode|null): void {\n    void Common.Revealer.reveal(node);\n  }\n\n  return root;\n};\n\nlet linkifierInstance: Linkifier;\n\nexport class Linkifier implements Common.Linkifier.Linkifier {\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): Linkifier {\n    const {forceNew} = opts;\n    if (!linkifierInstance || forceNew) {\n      linkifierInstance = new Linkifier();\n    }\n\n    return linkifierInstance;\n  }\n  linkify(object: Object, options?: Common.Linkifier.Options): Node {\n    if (object instanceof SDK.DOMModel.DOMNode) {\n      return linkifyNodeReference(object, options);\n    }\n    if (object instanceof SDK.DOMModel.DeferredDOMNode) {\n      return linkifyDeferredNodeReference(object, options);\n    }\n    throw new Error('Can\\'t linkify non-node');\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
