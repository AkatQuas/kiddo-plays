{
  "version": 3,
  "sources": ["../../../../../../front_end/panels/issues/AffectedDirectivesView.ts"],
  "sourcesContent": ["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as IssuesManager from '../../models/issues_manager/issues_manager.js';\nimport * as ElementsComponents from '../elements/components/components.js';\n\nimport {AffectedItem, AffectedResourcesView} from './AffectedResourcesView.js';\n\nconst UIStrings = {\n  /**\n  *@description Singular or plural label for number of affected CSP (content security policy,\n  * see https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP) directives in issue view.\n  */\n  nDirectives: '{n, plural, =1 {# directive} other {# directives}}',\n  /**\n  *@description Indicates that a CSP error should be treated as a warning\n  */\n  reportonly: 'report-only',\n  /**\n  *@description The kind of resolution for a mixed content issue\n  */\n  blocked: 'blocked',\n  /**\n  *@description Tooltip for button linking to the Elements panel\n  */\n  clickToRevealTheViolatingDomNode: 'Click to reveal the violating DOM node in the Elements panel',\n  /**\n  *@description Header for the section listing affected directives\n  */\n  directiveC: 'Directive',\n  /**\n  *@description Label for the column in the element list in the CSS Overview report\n  */\n  element: 'Element',\n  /**\n  *@description Header for the source location column\n  */\n  sourceLocation: 'Source Location',\n  /**\n  *@description Text for the status of something\n  */\n  status: 'Status',\n  /**\n  *@description Text that refers to the resources of the web page\n  */\n  resourceC: 'Resource',\n};\n\nconst str_ = i18n.i18n.registerUIStrings('panels/issues/AffectedDirectivesView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class AffectedDirectivesView extends AffectedResourcesView {\n  #appendStatus(element: Element, isReportOnly: boolean): void {\n    const status = document.createElement('td');\n    if (isReportOnly) {\n      status.classList.add('affected-resource-report-only-status');\n      status.textContent = i18nString(UIStrings.reportonly);\n    } else {\n      status.classList.add('affected-resource-blocked-status');\n      status.textContent = i18nString(UIStrings.blocked);\n    }\n    element.appendChild(status);\n  }\n\n  protected getResourceNameWithCount(count: number): Platform.UIString.LocalizedString {\n    return i18nString(UIStrings.nDirectives, {n: count});\n  }\n\n  #appendViolatedDirective(element: Element, directive: string): void {\n    const violatedDirective = document.createElement('td');\n    violatedDirective.textContent = directive;\n    element.appendChild(violatedDirective);\n  }\n\n  #appendBlockedURL(element: Element, url: Platform.DevToolsPath.UrlString): void {\n    const info = document.createElement('td');\n    info.classList.add('affected-resource-directive-info');\n    info.textContent = url;\n    element.appendChild(info);\n  }\n\n  #appendBlockedElement(\n      element: Element, nodeId: Protocol.DOM.BackendNodeId|undefined, model: SDK.IssuesModel.IssuesModel): void {\n    const elementsPanelLinkComponent = new ElementsComponents.ElementsPanelLink.ElementsPanelLink();\n    if (nodeId) {\n      const violatingNodeId = nodeId;\n      elementsPanelLinkComponent.title = i18nString(UIStrings.clickToRevealTheViolatingDomNode);\n\n      const onElementRevealIconClick: (arg0?: Event|undefined) => void = (): void => {\n        const target = model.getTargetIfNotDisposed();\n        if (target) {\n          Host.userMetrics.issuesPanelResourceOpened(this.issue.getCategory(), AffectedItem.Element);\n          const deferredDOMNode = new SDK.DOMModel.DeferredDOMNode(target, violatingNodeId);\n          void Common.Revealer.reveal(deferredDOMNode);\n        }\n      };\n\n      const onElementRevealIconMouseEnter: (arg0?: Event|undefined) => void = (): void => {\n        const target = model.getTargetIfNotDisposed();\n        if (target) {\n          const deferredDOMNode = new SDK.DOMModel.DeferredDOMNode(target, violatingNodeId);\n          if (deferredDOMNode) {\n            deferredDOMNode.highlight();\n          }\n        }\n      };\n\n      const onElementRevealIconMouseLeave: (arg0?: Event|undefined) => void = (): void => {\n        SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight();\n      };\n\n      elementsPanelLinkComponent\n          .data = {onElementRevealIconClick, onElementRevealIconMouseEnter, onElementRevealIconMouseLeave};\n    }\n\n    const violatingNode = document.createElement('td');\n    violatingNode.classList.add('affected-resource-csp-info-node');\n    violatingNode.appendChild(elementsPanelLinkComponent);\n    element.appendChild(violatingNode);\n  }\n\n  #appendAffectedContentSecurityPolicyDetails(\n      cspIssues: Iterable<IssuesManager.ContentSecurityPolicyIssue.ContentSecurityPolicyIssue>): void {\n    const header = document.createElement('tr');\n    if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.inlineViolationCode) {\n      this.appendColumnTitle(header, i18nString(UIStrings.directiveC));\n      this.appendColumnTitle(header, i18nString(UIStrings.element));\n      this.appendColumnTitle(header, i18nString(UIStrings.sourceLocation));\n      this.appendColumnTitle(header, i18nString(UIStrings.status));\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.urlViolationCode) {\n      this.appendColumnTitle(header, i18nString(UIStrings.resourceC), 'affected-resource-directive-info-header');\n      this.appendColumnTitle(header, i18nString(UIStrings.status));\n      this.appendColumnTitle(header, i18nString(UIStrings.directiveC));\n      this.appendColumnTitle(header, i18nString(UIStrings.sourceLocation));\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.evalViolationCode) {\n      this.appendColumnTitle(header, i18nString(UIStrings.sourceLocation));\n      this.appendColumnTitle(header, i18nString(UIStrings.directiveC));\n      this.appendColumnTitle(header, i18nString(UIStrings.status));\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.trustedTypesSinkViolationCode) {\n      this.appendColumnTitle(header, i18nString(UIStrings.sourceLocation));\n      this.appendColumnTitle(header, i18nString(UIStrings.status));\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.trustedTypesPolicyViolationCode) {\n      this.appendColumnTitle(header, i18nString(UIStrings.sourceLocation));\n      this.appendColumnTitle(header, i18nString(UIStrings.directiveC));\n      this.appendColumnTitle(header, i18nString(UIStrings.status));\n    } else {\n      this.updateAffectedResourceCount(0);\n      return;\n    }\n    this.affectedResources.appendChild(header);\n    let count = 0;\n    for (const cspIssue of cspIssues) {\n      count++;\n      this.#appendAffectedContentSecurityPolicyDetail(cspIssue);\n    }\n    this.updateAffectedResourceCount(count);\n  }\n\n  #appendAffectedContentSecurityPolicyDetail(\n      cspIssue: IssuesManager.ContentSecurityPolicyIssue.ContentSecurityPolicyIssue): void {\n    const element = document.createElement('tr');\n    element.classList.add('affected-resource-directive');\n\n    const cspIssueDetails = cspIssue.details();\n    const location = IssuesManager.Issue.toZeroBasedLocation(cspIssueDetails.sourceCodeLocation);\n    const model = cspIssue.model();\n    const maybeTarget = cspIssue.model()?.getTargetIfNotDisposed();\n    if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.inlineViolationCode && model) {\n      this.#appendViolatedDirective(element, cspIssueDetails.violatedDirective);\n      this.#appendBlockedElement(element, cspIssueDetails.violatingNodeId, model);\n      this.appendSourceLocation(element, location, maybeTarget);\n      this.#appendStatus(element, cspIssueDetails.isReportOnly);\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.urlViolationCode) {\n      const url = cspIssueDetails.blockedURL ? cspIssueDetails.blockedURL as Platform.DevToolsPath.UrlString :\n                                               Platform.DevToolsPath.EmptyUrlString;\n      this.#appendBlockedURL(element, url);\n      this.#appendStatus(element, cspIssueDetails.isReportOnly);\n      this.#appendViolatedDirective(element, cspIssueDetails.violatedDirective);\n      this.appendSourceLocation(element, location, maybeTarget);\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.evalViolationCode) {\n      this.appendSourceLocation(element, location, maybeTarget);\n      this.#appendViolatedDirective(element, cspIssueDetails.violatedDirective);\n      this.#appendStatus(element, cspIssueDetails.isReportOnly);\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.trustedTypesSinkViolationCode) {\n      this.appendSourceLocation(element, location, maybeTarget);\n      this.#appendStatus(element, cspIssueDetails.isReportOnly);\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.trustedTypesPolicyViolationCode) {\n      this.appendSourceLocation(element, location, maybeTarget);\n      this.#appendViolatedDirective(element, cspIssueDetails.violatedDirective);\n      this.#appendStatus(element, cspIssueDetails.isReportOnly);\n    } else {\n      return;\n    }\n\n    this.affectedResources.appendChild(element);\n  }\n\n  update(): void {\n    this.clear();\n    this.#appendAffectedContentSecurityPolicyDetails(this.issue.getCspIssues());\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
