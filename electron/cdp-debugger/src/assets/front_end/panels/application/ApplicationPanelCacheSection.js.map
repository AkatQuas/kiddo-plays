{
  "version": 3,
  "sources": ["../../../../../../front_end/panels/application/ApplicationPanelCacheSection.ts"],
  "sourcesContent": ["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as ApplicationComponents from './components/components.js';\nimport * as Host from '../../core/host/host.js';\n\nimport {ApplicationPanelTreeElement, ExpandableApplicationPanelTreeElement} from './ApplicationPanelTreeElement.js';\nimport type {ResourcesPanel} from './ResourcesPanel.js';\nimport {ServiceWorkerCacheView} from './ServiceWorkerCacheViews.js';\n\nconst UIStrings = {\n  /**\n  *@description Text in Application Panel Sidebar of the Application panel\n  */\n  cacheStorage: 'Cache Storage',\n  /**\n  *@description Text in Application Panel Sidebar of the Application panel\n  */\n  backForwardCache: 'Back/forward cache',\n  /**\n  *@description A context menu item in the Application Panel Sidebar of the Application panel\n  */\n  refreshCaches: 'Refresh Caches',\n  /**\n  *@description Text to delete something\n  */\n  delete: 'Delete',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/application/ApplicationPanelCacheSection.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class ServiceWorkerCacheTreeElement extends ExpandableApplicationPanelTreeElement {\n  private swCacheModel: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel|null;\n  private swCacheTreeElements: Set<SWCacheTreeElement>;\n\n  constructor(resourcesPanel: ResourcesPanel) {\n    super(resourcesPanel, i18nString(UIStrings.cacheStorage), 'CacheStorage');\n    const icon = UI.Icon.Icon.create('mediumicon-database', 'resource-tree-item');\n    this.setLink(\n        'https://developer.chrome.com/docs/devtools/storage/cache/?utm_source=devtools' as\n        Platform.DevToolsPath.UrlString);\n    this.setLeadingIcons([icon]);\n    this.swCacheModel = null;\n    this.swCacheTreeElements = new Set();\n  }\n\n  initialize(model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel|null): void {\n    this.swCacheTreeElements.clear();\n    this.swCacheModel = model;\n    if (model) {\n      for (const cache of model.caches()) {\n        this.addCache(model, cache);\n      }\n    }\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, SDK.ServiceWorkerCacheModel.Events.CacheAdded,\n        this.cacheAdded, this);\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, SDK.ServiceWorkerCacheModel.Events.CacheRemoved,\n        this.cacheRemoved, this);\n  }\n\n  onattach(): void {\n    super.onattach();\n    this.listItemElement.addEventListener('contextmenu', this.handleContextMenuEvent.bind(this), true);\n  }\n\n  private handleContextMenuEvent(event: MouseEvent): void {\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    contextMenu.defaultSection().appendItem(i18nString(UIStrings.refreshCaches), this.refreshCaches.bind(this));\n    void contextMenu.show();\n  }\n\n  private refreshCaches(): void {\n    if (this.swCacheModel) {\n      this.swCacheModel.refreshCacheNames();\n    }\n  }\n\n  private cacheAdded(event: Common.EventTarget.EventTargetEvent<SDK.ServiceWorkerCacheModel.CacheEvent>): void {\n    const {model, cache} = event.data;\n    this.addCache(model, cache);\n  }\n\n  private addCache(\n      model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, cache: SDK.ServiceWorkerCacheModel.Cache): void {\n    const swCacheTreeElement = new SWCacheTreeElement(this.resourcesPanel, model, cache);\n    this.swCacheTreeElements.add(swCacheTreeElement);\n    this.appendChild(swCacheTreeElement);\n  }\n\n  private cacheRemoved(event: Common.EventTarget.EventTargetEvent<SDK.ServiceWorkerCacheModel.CacheEvent>): void {\n    const {model, cache} = event.data;\n    const swCacheTreeElement = this.cacheTreeElement(model, cache);\n    if (!swCacheTreeElement) {\n      return;\n    }\n\n    this.removeChild(swCacheTreeElement);\n    this.swCacheTreeElements.delete(swCacheTreeElement);\n    this.setExpandable(this.childCount() > 0);\n  }\n\n  private cacheTreeElement(\n      model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel,\n      cache: SDK.ServiceWorkerCacheModel.Cache): SWCacheTreeElement|null {\n    for (const cacheTreeElement of this.swCacheTreeElements) {\n      if (cacheTreeElement.hasModelAndCache(model, cache)) {\n        return cacheTreeElement;\n      }\n    }\n    return null;\n  }\n}\n\nexport class SWCacheTreeElement extends ApplicationPanelTreeElement {\n  private readonly model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel;\n  private cache: SDK.ServiceWorkerCacheModel.Cache;\n  private view: ServiceWorkerCacheView|null;\n\n  constructor(\n      resourcesPanel: ResourcesPanel, model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel,\n      cache: SDK.ServiceWorkerCacheModel.Cache) {\n    super(resourcesPanel, cache.cacheName + ' - ' + cache.securityOrigin, false);\n    this.model = model;\n    this.cache = cache;\n    this.view = null;\n    const icon = UI.Icon.Icon.create('mediumicon-table', 'resource-tree-item');\n    this.setLeadingIcons([icon]);\n  }\n\n  get itemURL(): Platform.DevToolsPath.UrlString {\n    // I don't think this will work at all.\n    return 'cache://' + this.cache.cacheId as Platform.DevToolsPath.UrlString;\n  }\n\n  onattach(): void {\n    super.onattach();\n    this.listItemElement.addEventListener('contextmenu', this.handleContextMenuEvent.bind(this), true);\n  }\n\n  private handleContextMenuEvent(event: MouseEvent): void {\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    contextMenu.defaultSection().appendItem(i18nString(UIStrings.delete), this.clearCache.bind(this));\n    void contextMenu.show();\n  }\n\n  private clearCache(): void {\n    void this.model.deleteCache(this.cache);\n  }\n\n  update(cache: SDK.ServiceWorkerCacheModel.Cache): void {\n    this.cache = cache;\n    if (this.view) {\n      this.view.update(cache);\n    }\n  }\n\n  onselect(selectedByUser: boolean|undefined): boolean {\n    super.onselect(selectedByUser);\n    if (!this.view) {\n      this.view = new ServiceWorkerCacheView(this.model, this.cache);\n    }\n\n    this.showView(this.view);\n    Host.userMetrics.panelShown(Host.UserMetrics.PanelCodes[Host.UserMetrics.PanelCodes.service_worker_cache]);\n    return false;\n  }\n\n  hasModelAndCache(\n      model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, cache: SDK.ServiceWorkerCacheModel.Cache): boolean {\n    return this.cache.equals(cache) && this.model === model;\n  }\n}\n\nexport class BackForwardCacheTreeElement extends ApplicationPanelTreeElement {\n  private view?: ApplicationComponents.BackForwardCacheView.BackForwardCacheViewWrapper;\n\n  constructor(resourcesPanel: ResourcesPanel) {\n    super(resourcesPanel, i18nString(UIStrings.backForwardCache), false);\n    const icon = UI.Icon.Icon.create('mediumicon-database', 'resource-tree-item');\n    this.setLeadingIcons([icon]);\n  }\n\n  get itemURL(): Platform.DevToolsPath.UrlString {\n    return 'bfcache://' as Platform.DevToolsPath.UrlString;\n  }\n\n  onselect(selectedByUser?: boolean): boolean {\n    super.onselect(selectedByUser);\n    if (!this.view) {\n      this.view = new ApplicationComponents.BackForwardCacheView.BackForwardCacheViewWrapper();\n    }\n    this.showView(this.view);\n    Host.userMetrics.panelShown(Host.UserMetrics.PanelCodes[Host.UserMetrics.PanelCodes.back_forward_cache]);\n    return false;\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
