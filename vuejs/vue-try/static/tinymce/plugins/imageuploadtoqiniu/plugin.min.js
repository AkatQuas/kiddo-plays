tinymce.PluginManager.add("imageuploadtoqiniu",function(a){var b=function(){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"image-pick",uptoken_url:"/fetch_token?img=1",domain:"http://7xjkhy.dl1.z0.glb.clouddn.com/",max_retries:3,auto_start:!0,init:{FileUploaded:function(a,b,c){var d=a.getOption("domain"),e=jQuery.parseJSON(c),f=d+e.key;$("#img-state").text("\u4e0a\u4f20\u5b8c\u6210!").show(),$("#image-url").val(f)},UploadProgress:function(a,b){b.status===plupload.UPLOADING?$("#img-state").text("\u6b63\u5728\u4e0a\u4f20  "+b.percent+"%").show():$("#img-state").text("\u6b63\u5728\u5c1d\u8bd5\u4e0a\u4f20...").show()},Error:function(a,b,c){$("#img-state").text("\u4e0a\u4f20\u51fa\u9519,\u8bf7\u91cd\u8bd5\uff01").show()}}})},c=function(a){a.windowManager.open({title:"Insert/edit image",body:[{id:"image-url",type:"textbox",name:"url",label:"Image URL"},{type:"button",text:"Pick a image",name:"image-pick",id:"image-pick"},{type:"label",text:"\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740\u6216\u4ece\u672c\u5730\u9009\u62e9\u4e0a\u4f20!",id:"img-state"}],onsubmit:function(b){d(a)}}),b()},d=function(a){a.insertContent('<img src="'+$("#image-url").val()+'"/>')};a.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:function(){c(a)}}),a.addMenuItem("image",{icon:"image",text:"Insert/edit image",context:"insert",onclick:function(){c(a)},prependToContext:!0})});